<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.neefull.fsp.web.sms.mapper.ScanMapper">
    <update id="updateScanStatus">
        update sms_scan set status = #{status} where id = #{id}
    </update>
    <update id="deleteScanById">
        update sms_scan set del = #{del} where id = #{id}
    </update>


    <select id="queryScanDetailList" resultType="com.neefull.fsp.web.sms.entity.Scan">
        select * from sms_scan t  where  del = 1
        <choose>
            <when test="scan.plant != null and scan.plant != ''">
                AND t.plant like concat('%',#{scan.plant},'%')
            </when>
            <otherwise>
                AND t.plant  in
                <foreach collection="scan.plants" index="index" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </otherwise>
        </choose>
        <if test="scan.delivery != null and scan.delivery != ''">
            AND t.delivery like concat('%',#{scan.delivery},'%')
        </if>
        <if test="scan.matCode != null and scan.matCode != ''">
            AND t.mat_code like concat('%',#{scan.matCode},'%')
        </if>
        <if test="scan.batch != null and scan.batch != ''">
            AND t.batch like concat('%',#{scan.batch},'%')
        </if>
        order by t.create_time desc
    </select>
    <select id="getScanInfoList" resultType="com.neefull.fsp.web.sms.entity.Scan">
        select distinct t.delivery ,h.status,h.plant,h.sold_party,h.ship_party from sms_scan t
              left join sms_header h on t.delivery = h.delivery where  t.del = 1
        <choose>
            <when test="scan.plant != null and scan.plant != ''">
                AND t.plant like concat('%',#{scan.plant},'%')
            </when>
            <otherwise>
                AND t.plant  in
                <foreach collection="scan.plants" index="index" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </otherwise>
        </choose>
        <if test="scan.delivery != null and scan.delivery != ''">
            AND t.delivery like concat('%',#{scan.delivery},'%')
        </if>
        order by t.create_time desc
    </select>
    <select id="queryScanAndCountByDelivery" resultType="com.neefull.fsp.web.sms.entity.Scan">
        select t.*,d.quantity as count from sms_scan t left join sms_detail d  on
            t.delivery = d.delivery
                and t.mat_code = d.material
                    and t.batch = d.batch
                        where t.delivery = #{delivery} and t.del = 1
    </select>


</mapper>